<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title></title>
<link rel="stylesheet" href="css/bw.css">
        
<script language="Javascript" type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.js"></script>
<style>
</style>
    <script type="text/javascript">
        var clean_uri = location.protocol + "//" + location.host + location.pathname;
        window.history.replaceState({}, document.title, clean_uri);
    </script>
 

    </head>
    <body>
<div id="header">
    <h1>WotJam</h1>

</div>

<div id="section">
    <section class="loginform cf">
    <form name="login" accept-charset="utf-8">
    <table>
        <tr><td>
        <label for="usereventname">Name</label></td>
        <td><input type="text" id="eventname" name="Name" placeholder="Event Name here." required />  
        </td></tr><tr><td>
        <label for="usereventdesc">Description</label></td>
        <td><textarea id="description" name="Description" cols="25" rows="7">
        </textarea>  
        </td></tr>
    <table>
    </form>
    <div id="upload-global" class="popup">
    <form method="post" id="upload-global-form" enctype="multipart/form-data" action="https://imgur.com/upload">
           <div id="upload-global-start-upload">
            <div class="panel">
                <div>

                    <table id="upload-global-actions">
                        <tbody>
                            <tr><td width="49.6%"> Supported formats: JPEG, GIF, PNG, APNG, TIFF, BMP, PDF, XCF </td></tr>
                            <tr><td>
                            <input id="inputFileToLoad" type="file" onchange="loadImageFileAsURL();" />

                            <div id="imgTest"></div>
                            </td></tr>
                        </tbody>
                    </table>

                </div>
 
    </form>  
    </div>
    </section>  
</div>

        <script src="js/vendor/jquery-2.1.0.min.js"></script>
        <script src="js/helper.js"></script>
        <script src="js/main.js"></script>
<script type="text/javascript">
$(document).ready( function() {
    var api_url = 'http://localhost:4242/api/';
    var eiau_ser = [];
    function eiau(imgur_id) {
         $.ajax({
             async: false,
             url: api_url + 'event_image_add_update?imgur_id=' + imgur_id,
             type: "GET",
             dataType: 'JSON',
             success: 
                 function (series){
                     eiau_ser = eval(series);  
                 },
         });            
        if (eiau_ser[0]["status_id"] > 200) {                
            alert(eiau_ser[0]["status_desc"]); 
        } else {
            window.location.assign("event.html");
        };
        return false;
        };



});

function imgurUpload(bass) {

    var auth;
    auth = 'Client-ID bd900681799a752';
    console.log('' + bass);
    $.ajax({
      url: 'https://api.imgur.com/3/upload',
      type: 'POST',
      headers: {
        Authorization: 'Client-ID bd900681799a752',
        Accept: 'application/json'
      },
      data: {
        image: bass,
        type: 'base64'
      },
      success: function(result) {
        var api_url = 'http://localhost:4242/api/';
        console.log('cool ' + result.data.id );
        console.log('full ' + result );
         $.ajax({
             type: "GET",
             url: api_url + 'event_add_update?email=' + email + '&name=' + name + '&description=' + desc + '&start=' + start + '&end=' + end + '&evt_id=' + evt_id + '&band=' + band + '&img=' + result.data.id,
             datatype: 'JSON',
             success: function (data) {
                window.location.assign("eventone.html?" + data.evt_id);                 
             }
        })
      }});
    
}

function loadImageFileAsURL(){
    console.log('pressed,');
    var filesSelected = document.getElementById("inputFileToLoad").files;
    if (filesSelected.length > 0){
        var fileToLoad = filesSelected[0];

        var fileReader = new FileReader();

        fileReader.onload = function(fileLoadedEvent) {
            var srcData = fileLoadedEvent.target.result; 

            var divTest = document.getElementById("imgTest");
            var newImage = document.createElement('img');
            newImage.src = srcData;

            divTest.innerHTML = newImage.outerHTML;

            imgurUpload(srcData.substring(23));
        }
        fileReader.readAsDataURL(fileToLoad);

    }

}

</script>
    </body>
</html>
