<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title></title>
<link rel="stylesheet" href="css/bw.css">
        
<script language="Javascript" type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.js"></script>
<style>
</style>
    <script type="text/javascript">
        var clean_uri = location.protocol + "//" + location.host + location.pathname;
        window.history.replaceState({}, document.title, clean_uri);
    </script>
    <script type="text/javascript">
    var datefield=document.createElement("input")
    datefield.setAttribute("type", "date")
    if (datefield.type!="date"){ //if browser doesn't support input type="date", load files for jQuery UI Date Picker
        document.write('<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css" />\n')
        document.write('<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js"><\/script>\n')
        document.write('<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"><\/script>\n')
    }
</script>
<script>
if (datefield.type!="date"){ //if browser doesn't support input type="date", initialize date picker widget:
    jQuery(function($){ //on document.ready
        $('#datepick').datepicker();
    })
}
</script>
    </head>
    <body>
<div id="header">
    <h1>WotJam</h1>

</div>

<div id="section">
    <section class="loginform cf">
    <form name="eventadd" accept-charset="utf-8">
    <table>
        <tr><td>
        <label for="usereventname">Name</label></td>
        <td><input type="text" id="eventname" name="Name" placeholder="Event Name here." required />  
        </td></tr><tr><td>
        <label for="usereventdesc">Description</label></td>
        <td><textarea id="description" name="Description" cols="25" rows="7">
        </textarea>  
        </td></tr>
        <tr><td>Start Date</td>
        <td><input type="date" id="usereventstart" name="datepick" size="20" />
        </td></tr>
        <tr><td>End Date</td>
        <td><input type="date" id="usereventend" name="datepick" size="20" />
        </td></tr>
        <tr><td>Image</td>
        <td><input id="inputFileToLoad" type="file" onchange="loadImageFileAsURL();" />
        </td></tr>
    </table>
    <table>
        <tr><td>
        <div id="imgTest"></div>
        </td></tr>
    </table>
    </form>
    </section>  
</div>

        <script src="js/vendor/jquery-2.1.0.min.js"></script>
        <script src="js/helper.js"></script>
        <script src="js/main.js"></script>
        <script src="js/uri.js"></script>

<script type="text/javascript">

    function imgurUpload(bass) {

        var auth;
        auth = 'Client-ID bd900681799a752';
        $.ajax({
          url: 'https://api.imgur.com/3/upload',
          type: 'POST',
          headers: {
            Authorization: 'Client-ID bd900681799a752',
            Accept: 'application/json'
          },
          data: {
            image: bass,
            type: 'base64'
          },
          success: function(result) {
            var api_url = 'http://localhost:4242/api/';
            var email = 'colin@wotjam.com';
            var name = document.getElementById("usereventname");
            var desc = document.getElementById("usereventdesc");
            var start = document.getElementById("usereventstart").value;
            var end = document.getElementById("usereventend").value;
            var evt_id = URI(document.evt_id).query(true).value;
            var band = document.getElementById("usereventband");
            var eiau_ser = [];
            var imgur = result.data.id;
            console.log('cool ' + imgur );
            $.ajax({
                 type: "GET",
                 url: api_url + 'event_add_update?email=' + email + '&name=' + name + '&description=' + desc + '&start=' + start + '&end=' + end + '&evt_id=' + evt_id + '&band=' + band + '&img=' + imgur + '&img_type=jpeg',
                 datatype: 'JSON',
                 success: function (data) {  
                    eiau_ser = eval(data); 
                    console.log(eiau_ser[0]["status_id"]); 
                    window.location.assign("eventone.html?evt_id=" + eiau_ser[0]["event_id"]);   
                 },
                 error: function () {
                    alert(eiau_ser[0]["status_desc"]); 
                }
            })

            return false;
        }})
    }

    function loadImageFileAsURL(){
        console.log('pressed,');
        var filesSelected = document.getElementById("inputFileToLoad").files;
        if (filesSelected.length > 0){
            var fileToLoad = filesSelected[0];

            var fileReader = new FileReader();

            fileReader.onload = function(fileLoadedEvent) {
                var srcData = fileLoadedEvent.target.result; 

                var divTest = document.getElementById("imgTest");
                var newImage = document.createElement('img');
                newImage.src = srcData;

                divTest.innerHTML = newImage.outerHTML;

                imgurUpload(srcData.substring(23));
            }
            fileReader.readAsDataURL(fileToLoad);
        }
    }

</script>
    </body>
</html>
